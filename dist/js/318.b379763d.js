/*! For license information please see 318.b379763d.js.LICENSE.txt */
(self.webpackChunkfzz_react_app=self.webpackChunkfzz_react_app||[]).push([[318],{3312:()=>{},8318:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>I});var r=n(2284),a=n(4467),i=n(5458),o=n(467),c=n(296),l=n(6540),u=n(1083),s=n(1225);function m(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError((0,r.A)(e)+" is not iterable")}function d(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function i(n,r,a,i){var l=r&&r.prototype instanceof c?r:c,u=Object.create(l.prototype);return v(u,"_invoke",function(n,r,a){var i,c,l,u=0,s=a||[],m=!1,d={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return i=t,c=0,l=e,d.n=n,o}};function f(n,r){for(c=n,l=r,t=0;!m&&u&&!a&&t<s.length;t++){var a,i=s[t],f=d.p,p=i[2];n>3?(a=p===r)&&(l=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=f&&((a=n<2&&f<i[1])?(c=0,d.v=r,d.n=i[1]):f<p&&(a=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,d.n=p,c=0))}if(a||n>1)return o;throw m=!0,r}return function(a,s,p){if(u>1)throw TypeError("Generator is already running");for(m&&1===s&&f(s,p),c=s,l=p;(t=c<2?e:l)||!m;){i||(c?c<3?(c>1&&(d.n=-1),f(c,l)):d.n=l:d.v=l);try{if(u=2,i){if(c||(a="next"),t=i[a]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),c=1);i=e}else if((t=(m=d.n<0)?l:n.call(r,d))!==o)break}catch(t){i=e,c=1,l=t}finally{u=1}}return{value:t,done:m}}}(n,a,i),!0),u}var o={};function c(){}function l(){}function u(){}t=Object.getPrototypeOf;var s=[][r]?t(t([][r]())):(v(t={},r,function(){return this}),t),m=u.prototype=c.prototype=Object.create(s);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,v(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=u,v(m,"constructor",u),v(u,"constructor",l),l.displayName="GeneratorFunction",v(u,a,"GeneratorFunction"),v(m),v(m,a,"Generator"),v(m,r,function(){return this}),v(m,"toString",function(){return"[object Generator]"}),(p=function(){return{w:i,m:d}})()}function v(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}v=function(e,t,n,r){function i(t,n){v(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},v(e,t,n,r)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,a.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n(3312);var y=null,b=null;function E(){return Math.random().toString(36).slice(2,9)}var w={lat:39.9042,lng:116.4074};function N(){return!("undefined"==typeof window||!window.CONFIG||!window.CONFIG.TIANDITU_TOKEN)}function k(){var e=new Date,t=function(e){return e<10?"0"+e:""+e};return{date:"".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate())),time:"".concat(t(e.getHours()),":").concat(t(e.getMinutes()))}}function C(){var e="undefined"!=typeof window&&window.CONFIG?window.CONFIG:{};return{initialZoom:"number"==typeof e.MAP_INITIAL_ZOOM?e.MAP_INITIAL_ZOOM:11,customTile:{url:e.MAP_TILE_URL||"",attribution:e.MAP_ATTRIBUTION||"",subdomains:e.MAP_SUBDOMAINS||void 0}}}function S(e){return e*Math.PI/180}function T(e,t,n,r){var a=S(n-e),i=S(r-t),o=S(e),c=S(n),l=Math.pow(Math.sin(a/2),2)+Math.cos(o)*Math.cos(c)*Math.pow(Math.sin(i/2),2);return 12742*Math.asin(Math.min(1,Math.sqrt(l)))}function x(e){return isFinite(e)?e<1.5?"步行":e<15?"地铁":e<80?"大巴":"高铁":"步行"}function A(e,t){if(!e)return t||"";var n=[],r=e.state||e.province||"",a=e.city||e.town||e.village||"",i=e.city_district||e.district||e.county||"",o=e.road||e.residential||e.neighbourhood||"",c=e.house_number||"",l=e.amenity||e.tourism||e.building||e.hotel||e.shop||"";return r&&n.push(r),a&&!n.includes(a)&&n.push(a),i&&n.push(i),o&&n.push(o+(c||"")),l&&n.push(l),n.join("")||t||""}var _=new Map,O=new Map;function I(){var e=(0,l.useRef)(null),t=(0,l.useRef)(null),n=(0,l.useRef)(null),r=(0,l.useRef)(null),f=(0,l.useRef)(null),v=(0,l.useRef)({}),g=(0,l.useState)(!1),S=(0,c.A)(g,2),I=S[0],F=S[1],L=(0,l.useState)("我的旅行计划"),M=(0,c.A)(L,2),G=M[0],D=M[1],P=(0,l.useState)(null),j=(0,c.A)(P,2),R=j[0],z=j[1],U=(0,l.useState)([]),q=(0,c.A)(U,2),V=q[0],B=q[1],K=(0,l.useState)(""),W=(0,c.A)(K,2),Z=W[0],X=W[1],Q=(0,l.useState)(null),H=(0,c.A)(Q,2),Y=H[0],$=H[1],J=(0,l.useState)(""),ee=(0,c.A)(J,2),te=ee[0],ne=ee[1],re=(0,l.useState)(!0),ae=(0,c.A)(re,2),ie=ae[0],oe=ae[1],ce=(0,l.useState)([]),le=(0,c.A)(ce,2),ue=le[0],se=le[1],me=(0,l.useState)(function(){var e="undefined"!=typeof window&&window.CONFIG?window.CONFIG:{};return e.DEFAULT_TILE_KEY?e.DEFAULT_TILE_KEY:C().customTile.url?"custom":"amap"}),de=(0,c.A)(me,2),fe=de[0],pe=de[1],ve=(0,l.useState)("list"),ge=(0,c.A)(ve,2),he=ge[0],ye=ge[1],be=(0,l.useState)(!1),Ee=(0,c.A)(be,2),we=Ee[0],Ne=Ee[1],ke=(0,l.useState)(null),Ce=(0,c.A)(ke,2),Se=Ce[0],Te=Ce[1],xe=(0,l.useRef)(0),Ae=(0,l.useRef)(!1),_e=(0,l.useRef)(0),Oe=(0,l.useState)(!1),Ie=(0,c.A)(Oe,2),Fe=Ie[0],Le=Ie[1],Me=(0,l.useRef)(new Map),Ge=(0,l.useState)([]),De=(0,c.A)(Ge,2),Pe=De[0],je=De[1],Re=(0,s.wA)(),ze=(0,s.d4)(function(e){return{travelPlans:e.travelPlans,travelPlansLoading:e.travelPlansLoading,travelPlansError:e.travelPlansError,currentPlan:e.currentPlan,planSaving:e.planSaving,planSaveError:e.planSaveError,planDeleting:e.planDeleting,planDeleteError:e.planDeleteError,currentPlanError:e.currentPlanError}}),Ue=ze.travelPlans,qe=ze.travelPlansLoading,Ve=ze.travelPlansError,Be=ze.currentPlan,Ke=ze.planSaving,We=ze.planSaveError,Ze=ze.planDeleting,Xe=ze.planDeleteError,Qe=ze.currentPlanError;(0,l.useEffect)(function(){var a=!1;return(window.L?Promise.resolve(window.L):y||(y=new Promise(function(e,t){var n=document.createElement("link");n.rel="stylesheet",n.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(n);var r=document.createElement("script");r.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",r.async=!0,r.defer=!0,r.onload=function(){return e(window.L)},r.onerror=function(){return t(new Error("Failed to load Leaflet"))},document.body.appendChild(r)}))).then(function(c){if(!a&&e.current){var l=C().initialZoom,u=c.map(e.current,{zoomAnimation:!1,markerZoomAnimation:!1,scrollWheelZoom:!0}).setView([w.lat,w.lng],l);!function(e){var t={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; OpenStreetMap contributors",subdomains:["a","b","c"]},r={default:t,amap:{url:"https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",attribution:"© 高德地图(仅供开发调试)",subdomains:["1","2","3","4"]},geoqBlue:{url:"https://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",attribution:"© GeoQ"},geoqGray:{url:"https://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",attribution:"© GeoQ"},geoqWarm:{url:"https://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}",attribution:"© GeoQ"},esriStreet:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"},esriImagery:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"},tdtVec:N()?{compose:[{url:"https://t{s}.tianditu.gov.cn/vec_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=vec&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]},{url:"https://t{s}.tianditu.gov.cn/cva_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=cva&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]}],attribution:"© 天地图"}:void 0,tdtImg:N()?{compose:[{url:"https://t{s}.tianditu.gov.cn/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=img&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]},{url:"https://t{s}.tianditu.gov.cn/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=cia&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]}],attribution:"© 天地图"}:void 0},a=function(){var e=_e.current;return _e.current=e+1,0===e?"amap":1===e&&N()?"tdtVec":1!==e||N()?2===e?"esriStreet":3===e?"esriImagery":"default":"esriStreet"},i=C().customTile,o=t;if(e in r&&r[e]?o=r[e]:"custom"===e&&i.url&&(o={url:i.url,attribution:i.attribution||t.attribution,subdomains:i.subdomains||t.subdomains}),n.current){try{n.current.remove()}catch(e){}n.current=null}if(xe.current=0,Ae.current=!1,_e.current=0,o&&o.compose&&Array.isArray(o.compose)){var l=o.compose.map(function(e){var t={attribution:o.attribution||e.attribution,maxZoom:19,crossOrigin:!0,updateWhenIdle:!0};e.subdomains&&(t.subdomains=e.subdomains);var n=c.tileLayer(e.url,t);return n.on("tileerror",function(){Ae.current||++xe.current>=2&&(Ae.current=!0,pe(a()))}),n});n.current=c.layerGroup(l).addTo(u)}else{var s={attribution:o.attribution,maxZoom:19,crossOrigin:!0,updateWhenIdle:!0};o.subdomains&&(s.subdomains=o.subdomains);var m=c.tileLayer(o.url,s);m.on("tileerror",function(){Ae.current||++xe.current>=2&&(Ae.current=!0,pe(a()))}),n.current=m.addTo(u)}}(fe),t.current=u,F(!0),u.on("click",function(){var e=(0,o.A)(p().m(function e(t){var n,r,a,o,c;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.latlng.lat,r=t.latlng.lng,a=k(),o={id:E(),placeId:"",name:"标记点",lat:n,lng:r,date:a.date,time:a.time,notes:""},He(o),B(function(e){return[].concat((0,i.A)(e),[o])}),e.p=1,e.n=2,tt(n,r);case 2:c=e.v,B(function(e){return e.map(function(e){return e.id===o.id?h(h({},e),{},{name:c||e.name}):e})}),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}()),(window.L&&window.L.markerClusterGroup?Promise.resolve(!0):b||(b=new Promise(function(e,t){var n=document.createElement("link");n.rel="stylesheet",n.href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css",document.head.appendChild(n);var r=document.createElement("link");r.rel="stylesheet",r.href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css",document.head.appendChild(r);var a=document.createElement("script");a.src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js",a.async=!0,a.defer=!0,a.onload=function(){return e(!0)},a.onerror=function(){return t(new Error("Failed to load MarkerCluster"))},document.body.appendChild(a)}))).then(function(){if(window.L&&t.current){var e=window.L.markerClusterGroup({showCoverageOnHover:!1,spiderfyOnMaxZoom:!0,chunkedLoading:!0,removeOutsideVisibleBounds:!0});r.current=e,u.addLayer(e),Object.values(v.current).forEach(function(t){try{e.addLayer(t)}catch(e){}})}}).catch(function(){});try{f.current=window.L.layerGroup().addTo(u)}catch(e){f.current=null}}}).catch(function(e){return X(e.message)}),function(){a=!0}},[]),(0,l.useEffect)(function(){if(t.current&&window.L){var e=window.L,r={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; OpenStreetMap contributors",subdomains:["a","b","c"]},a={default:r,amap:{url:"https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",attribution:"© 高德地图(仅供开发调试)",subdomains:["1","2","3","4"]},geoqBlue:{url:"https://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",attribution:"© GeoQ"},geoqGray:{url:"https://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",attribution:"© GeoQ"},geoqWarm:{url:"https://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}",attribution:"© GeoQ"},esriStreet:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"},esriImagery:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"© Esri"},tdtVec:N()?{compose:[{url:"https://t{s}.tianditu.gov.cn/vec_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=vec&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]},{url:"https://t{s}.tianditu.gov.cn/cva_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=cva&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]}],attribution:"© 天地图"}:void 0,tdtImg:N()?{compose:[{url:"https://t{s}.tianditu.gov.cn/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=img&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]},{url:"https://t{s}.tianditu.gov.cn/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=cia&tilematrixSet=w&TileMatrix={z}&TileRow={y}&TileCol={x}&style=default&format=tiles&tk="+window.CONFIG.TIANDITU_TOKEN,subdomains:["0","1","2","3","4","5","6","7"]}],attribution:"© 天地图"}:void 0},i=C().customTile,o=r;if(fe in a&&a[fe]?o=a[fe]:"custom"===fe&&i.url&&(o={url:i.url,attribution:i.attribution||r.attribution,subdomains:i.subdomains||r.subdomains}),n.current){try{n.current.remove()}catch(e){}n.current=null}xe.current=0,Ae.current=!1,_e.current=0;var c=function(){var e=_e.current;return _e.current=e+1,0===e?"amap":1===e&&N()?"tdtVec":1!==e||N()?2===e?"esriStreet":3===e?"esriImagery":"default":"esriStreet"};if(o&&o.compose&&Array.isArray(o.compose)){var l=o.compose.map(function(t){var n={attribution:o.attribution||t.attribution,maxZoom:19,crossOrigin:!0,updateWhenIdle:!0};t.subdomains&&(n.subdomains=t.subdomains);var r=e.tileLayer(t.url,n);return r.on("tileerror",function(){Ae.current||++xe.current>=2&&(Ae.current=!0,pe(c()))}),r});n.current=e.layerGroup(l).addTo(t.current)}else{var u={attribution:o.attribution,maxZoom:19,crossOrigin:!0,updateWhenIdle:!0};o.subdomains&&(u.subdomains=o.subdomains);var s=e.tileLayer(o.url,u);s.on("tileerror",function(){Ae.current||++xe.current>=2&&(Ae.current=!0,pe(c()))}),n.current=s.addTo(t.current)}}},[fe]);var He=(0,l.useCallback)(function(e){if(t.current&&window.L){var n=window.L.marker([e.lat,e.lng],{draggable:!0});if(r.current&&r.current.addLayer)try{r.current.addLayer(n)}catch(e){n.addTo(t.current)}else n.addTo(t.current);n.on("dragend",function(){var t=(0,o.A)(p().m(function t(n){var r,a;return p().w(function(t){for(;;)switch(t.p=t.n){case 0:return r=n.target.getLatLng(),B(function(t){return t.map(function(t){return t.id===e.id?h(h({},t),{},{lat:r.lat,lng:r.lng}):t})}),t.p=1,t.n=2,tt(r.lat,r.lng);case 2:a=t.v,B(function(t){return t.map(function(t){return t.id===e.id?h(h({},t),{},{name:a||t.name}):t})}),t.n=4;break;case 3:t.p=3,t.v;case 4:return t.a(2)}},t,null,[[1,3]])}));return function(e){return t.apply(this,arguments)}}()),v.current[e.id]=n}},[]);(0,l.useEffect)(function(){window.L&&V.forEach(function(e,t){var n=v.current[e.id];if(n){var r=window.L&&window.L.divIcon?window.L.divIcon({className:"marker-index-icon",html:"<div>".concat(t+1,"</div>"),iconSize:[24,24],iconAnchor:[12,12]}):void 0;r&&n.setIcon(r)}})},[V]);var Ye=function(e){B(function(t){return t.filter(function(t){return t.id!==e})});var t=v.current[e];if(t){if(r.current&&r.current.removeLayer)try{r.current.removeLayer(t)}catch(e){try{t.remove()}catch(e){}}else try{t.remove()}catch(e){}delete v.current[e]}},$e=function(e,t){B(function(n){var r=n.slice(),a=e+t;if(a<0||a>=r.length)return n;var i=r.splice(e,1),o=(0,c.A)(i,1)[0];return r.splice(a,0,o),r})},Je=function(e,t){null!=e&&null!=t&&e!==t&&B(function(n){var r=n.slice();if(e<0||e>=r.length||t<0||t>=r.length)return n;var a=r.splice(e,1),i=(0,c.A)(a,1)[0];return r.splice(t,0,i),r})},et=function(e,t,n){B(function(r){return r.map(function(r){return r.id===e?h(h({},r),{},(0,a.A)({},t,n)):r})})},tt=((0,l.useCallback)(function(e,t){B(function(n){var r=n.findIndex(function(t){return t.id===e});if(r<0)return n;var a=n[r],i=String(a.notes||""),o=/(交通：)([^。；;，,\n]*)/;o.test(i)?i=i.replace(o,function(e,n){return"".concat(n).concat(t)}):i.trim()?i+=" · 交通：".concat(t):i="交通：".concat(t);var c=n.slice();return c[r]=h(h({},a),{},{notes:i}),c})},[]),function(){var e=(0,o.A)(p().m(function e(t,n){var r,a,i,o,c;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=t.toFixed(5)+","+n.toFixed(5),!O.has(r)){e.n=1;break}return e.a(2,O.get(r));case 1:return a=u.A.get("https://nominatim.openstreetmap.org/reverse",{params:{format:"jsonv2",lat:t,lon:n,addressdetails:1},headers:{Accept:"application/json","Accept-Language":"zh-CN"},timeout:6e3}).then(function(e){var t=e.data||{};return A(t.address||null,t.display_name||"")}),i=u.A.get("https://photon.komoot.io/reverse",{params:{lat:t,lon:n},timeout:6e3}).then(function(e){var t=e.data&&e.data.features&&e.data.features[0];return t&&t.properties&&(t.properties.name||t.properties.city||t.properties.street)||""}),e.p=2,e.n=3,Promise.race([a,i]);case 3:return o=e.v,O.set(r,o),e.a(2,o);case 4:return e.p=4,e.v,e.p=5,e.n=6,Promise.any([a,i]);case 6:return c=e.v,O.set(r,c),e.a(2,c);case 7:return e.p=7,e.v,e.a(2,"")}},e,null,[[5,7],[2,4]])}));return function(t,n){return e.apply(this,arguments)}}()),nt=(0,l.useCallback)(function(){Re({type:"TRAVEL_PLANS_FETCH_REQUEST"})},[Re]),rt=(0,l.useCallback)(function(e){e&&Re({type:"TRAVEL_PLAN_FETCH_REQUEST",payload:e})},[Re]),at=(0,l.useCallback)(function(){G.trim()?(X(""),Re({type:"TRAVEL_PLAN_SAVE_REQUEST",payload:{id:R,name:G.trim(),items:V}})):X("请输入计划名称")},[Re,R,G,V]),it=function(){if(z(null),D("我的旅行计划"),B([]),r.current&&r.current.clearLayers)try{r.current.clearLayers()}catch(e){}Object.values(v.current).forEach(function(e){try{e.remove()}catch(e){}}),v.current={}},ot=(0,l.useCallback)(function(){if(!R)return it();Re({type:"TRAVEL_PLAN_DELETE_REQUEST",payload:R})},[Re,R]);(0,l.useEffect)(function(){if(Be){if(r.current&&r.current.clearLayers)try{r.current.clearLayers()}catch(e){}Object.values(v.current).forEach(function(e){try{e.remove()}catch(e){}}),v.current={},z(Be.id||null),D(Be.name||"未命名计划");var e=Array.isArray(Be.items)?Be.items:[];B(e),setTimeout(function(){e.forEach(function(e){return He(e)}),e[0]&&t.current&&t.current.setView([e[0].lat,e[0].lng],C().initialZoom)},0)}},[Be,He]);var ct=(0,l.useRef)(null),lt=(0,l.useRef)(0),ut=(0,l.useState)(!1),st=(0,c.A)(ut,2),mt=st[0],dt=st[1],ft=(0,l.useCallback)(function(){var e=(0,o.A)(p().m(function e(n){var r,a,i,o,l,s,m,f,v,g,y,b,E,w,N,k,C;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if((r=(n||"").trim())&&!(r.length<2)){e.n=1;break}return se([]),e.a(2);case 1:if(a="global",i="",ie&&t.current&&(o=t.current.getBounds(),l=o.getWest().toFixed(3),s=o.getEast().toFixed(3),m=o.getNorth().toFixed(3),f=o.getSouth().toFixed(3),a="".concat(l,",").concat(m,",").concat(s,",").concat(f),i="&viewbox=".concat(l,",").concat(m,",").concat(s,",").concat(f,"&bounded=1")),v=r+"|"+a,!_.has(v)){e.n=2;break}return se(_.get(v)),e.a(2);case 2:return ct.current&&ct.current.cancel("cancelled"),g=u.A.CancelToken.source(),ct.current=g,dt(!0),y=++lt.current,b="https://nominatim.openstreetmap.org/search?format=jsonv2&addressdetails=1&limit=10&accept-language=zh-CN&q=".concat(encodeURIComponent(r)).concat(i),E=u.A.get(b,{headers:{Accept:"application/json"},timeout:7e3,cancelToken:g.token}).then(function(e){return Array.isArray(e.data)?e.data:[]}),w=u.A.get("https://photon.komoot.io/api/",{params:{q:r,limit:8},timeout:7e3,cancelToken:g.token}).then(function(e){return(e.data&&e.data.features||[]).map(function(e){return{place_id:e.properties&&e.properties.osm_id,osm_id:e.properties&&e.properties.osm_id,display_name:e.properties&&(e.properties.name||e.properties.street||e.properties.city||e.properties.country),lat:e.geometry&&e.geometry.coordinates?String(e.geometry.coordinates[1]):"0",lon:e.geometry&&e.geometry.coordinates?String(e.geometry.coordinates[0]):"0"}})}),e.p=3,e.n=4,Promise.race([E,w]);case 4:N=e.v,(k=t.current?t.current.getCenter():null)&&N.length&&(N=N.map(function(e){return h(h({},e),{},{__dist:Math.hypot(parseFloat(e.lat)-k.lat,parseFloat(e.lon)-k.lng)})}).sort(function(e,t){return(e.__dist||0)-(t.__dist||0)})),y===lt.current&&(_.set(v,N),se(N)),Promise.allSettled([E,w]).then(function(e){var n=(0,c.A)(e,2),r=n[0],a=n[1];if(y===lt.current){var i,o=("fulfilled"===r.status?r.value:[]).concat("fulfilled"===a.status?a.value:[]),l=new Set,u=[],s=d(o);try{for(s.s();!(i=s.n()).done;){var m=i.value,f="".concat(m.lat,"|").concat(m.lon,"|").concat(m.display_name);l.has(f)||(l.add(f),u.push(m))}}catch(e){s.e(e)}finally{s.f()}var p=t.current?t.current.getCenter():null,g=u;p&&u.length&&(g=u.map(function(e){return h(h({},e),{},{__dist:Math.hypot(parseFloat(e.lat)-p.lat,parseFloat(e.lon)-p.lng)})}).sort(function(e,t){return(e.__dist||0)-(t.__dist||0)})),_.set(v,g),se(g)}}),e.n=6;break;case 5:e.p=5,C=e.v,u.A.isCancel(C)||(X("地点搜索失败"),se([]));case 6:return e.p=6,dt(!1),e.f(6);case 7:return e.a(2)}},e,null,[[3,5,6,7]])}));return function(t){return e.apply(this,arguments)}}(),[ie]),pt=(0,l.useRef)(null),vt=(0,l.useCallback)(function(e){var t=((e.date||"")+" "+(e.time||"")).trim();return t&&Date.parse(t.replace(/-/g,"/"))||Number.MAX_SAFE_INTEGER},[]),gt=(0,l.useCallback)(function(e){return we?e.slice():e.map(function(e,t){return h(h({},e),{},{__idx:t})}).slice().sort(function(e,t){var n=vt(e),r=vt(t);return n===r?e.__idx-t.__idx:n-r})},[we,vt]),ht=(0,l.useMemo)(function(){return gt(V)},[V,gt]),yt=(0,l.useMemo)(function(){for(var e=V.map(function(){return null}),t=1;t<V.length;t++){var n=V[t-1],r=V[t];e[t]=T(n.lat,n.lng,r.lat,r.lng)}return e},[V]);(0,l.useMemo)(function(){for(var e=0,t={},n=1;n<V.length;n++){var r=yt[n];if(r){e+=r;var a=V[n].date||"";t[a]||(t[a]=0),t[a]+=r}}return{total:e,perDay:t}},[V,yt]),(0,l.useEffect)(function(){var e=!1;if(Fe){var t=function(){var t=(0,o.A)(p().m(function t(){var n,r,a,i;return p().w(function(t){for(;;)switch(t.n){case 0:n=new Array(V.length).fill(null),r=[],a=p().m(function e(t){var a,i,o,c,l;return p().w(function(e){for(;;)switch(e.n){case 0:if(a=V[t-1],i=V[t],isFinite(a.lat)&&isFinite(a.lng)&&isFinite(i.lat)&&isFinite(i.lng)){e.n=1;break}return e.a(2,0);case 1:if(o="".concat(a.lat.toFixed(5),",").concat(a.lng.toFixed(5),"|").concat(i.lat.toFixed(5),",").concat(i.lng.toFixed(5)),!(c=Me.current.get(o))){e.n=2;break}return n[t]=c,e.a(2,0);case 2:l="https://router.project-osrm.org/route/v1/driving/".concat(a.lng,",").concat(a.lat,";").concat(i.lng,",").concat(i.lat,"?overview=false&alternatives=false&steps=false"),r.push(u.A.get(l,{timeout:8e3}).then(function(e){var r=e.data&&e.data.routes,a=r&&r[0]&&r[0].distance,i=a?a/1e3:null;i&&(Me.current.set(o,i),n[t]=i)}).catch(function(){}));case 3:return e.a(2)}},e)}),i=1;case 1:if(!(i<V.length)){t.n=4;break}return t.d(m(a(i)),2);case 2:if(0!==t.v){t.n=3;break}return t.a(3,3);case 3:i++,t.n=1;break;case 4:return t.n=5,Promise.allSettled(r);case 5:e||je(n);case 6:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}();return t(),function(){e=!0}}je([])},[V,Fe]);var bt=(0,l.useMemo)(function(){for(var e=V.map(function(){return null}),t=1;t<V.length;t++){var n=Pe[t],r=yt[t];e[t]=Fe&&isFinite(n)&&n>0?n:r}return e},[V,Pe,yt,Fe]),Et=(0,l.useMemo)(function(){for(var e=0,t={},n=1;n<V.length;n++){var r=bt[n];if(r){e+=r;var a=V[n].date||"";t[a]||(t[a]=0),t[a]+=r}}return{total:e,perDay:t}},[V,bt]),wt=(0,l.useMemo)(function(){var e=new Map;V.forEach(function(t,n){var r=t.date||"未设日期";e.has(r)||e.set(r,[]),e.get(r).push({item:t,index:n})});var t,n=[],r=d(e.entries());try{var a=function(){var e=(0,c.A)(t.value,2),r=e[0],a=e[1],i=0;a.forEach(function(e){var t=e.index;if(t>=1&&V[t].date===r){var n=bt[t];n&&(i+=n)}});var o=a.map(function(e){return e.item.time}).filter(Boolean).sort(),l=o[0]||"",u=o[o.length-1]||"";n.push({day:r,entries:a,totalKm:i,start:l,end:u})};for(r.s();!(t=r.n()).done;)a()}catch(e){r.e(e)}finally{r.f()}return n.sort(function(e,t){return(e.day||"").localeCompare(t.day||"")}),n},[V,bt]),Nt=(0,l.useCallback)(function(){B(function(e){return e.slice().sort(function(e,t){return vt(e)-vt(t)})}),ye("day")},[vt]),kt=(0,l.useCallback)(function(e,t){B(function(n){var r=n.findIndex(function(t){return t.id===e});if(r<0)return n;var a=n[r],i=String(a.notes||""),o=/(耗时：)([^。；;，,\n]*)/;o.test(i)?i=i.replace(o,function(e,n){return"".concat(n).concat(t)}):i.trim()?i+=" · 耗时：".concat(t):i="耗时：".concat(t);var c=n.slice();return c[r]=h(h({},a),{},{notes:i}),c})},[]),Ct=(0,l.useCallback)(function(e,t){B(function(n){return n.map(function(n){return n.date===e?h(h({},n),{},{startOfDay:n.id===t}):n})})},[]),St=(0,l.useCallback)(function(e,t){B(function(n){return n.map(function(n){return n.date===e?h(h({},n),{},{endOfDay:n.id===t}):n})})},[]);(0,l.useEffect)(function(){if(t.current&&window.L&&f.current){try{f.current.clearLayers()}catch(e){}for(var e=1;e<V.length;e++){var n=V[e-1],r=V[e];if(isFinite(n.lat)&&isFinite(n.lng)&&isFinite(r.lat)&&isFinite(r.lng))try{var a=window.L.polyline([[n.lat,n.lng],[r.lat,r.lng]],{color:"#2952ff",weight:2,opacity:.9,dashArray:"6,6"});f.current.addLayer(a)}catch(e){}}}},[V]);var Tt=(0,l.useCallback)(function(e,t){B(function(n){var r=n.findIndex(function(t){return t.id===e});if(r<0)return n;var a=n[r],i=r>0?n[r-1]:null,o=function(e){if(!e)return"";var t=e.split("-"),n=(0,c.A)(t,3),r=(n[0],n[1]),a=n[2];return(r?String(parseInt(r,10)):"")+"月"+(a?String(parseInt(a,10)):"")+"日"}(a.date||""),l=i?T(i.lat,i.lng,a.lat,a.lng):0,u=a.notes||"";i&&"与上个地点直线距离约 ".concat(l.toFixed(1)," km。"),"play"===t?u="".concat(o," 在「").concat(a.name||"此地","」玩什么项目，预计消费 XXX 元。"):"move"===t?u="".concat(o," 从「").concat(i&&i.name||"上个地点","」到「").concat(a.name||"此地","」，直线距离约 ").concat(l.toFixed(1)," km。交通： ，耗时： ，预计消费 XXX 元。"):"stay"===t&&(u="".concat(o," 在「").concat(a.name||"此地","」入住酒店（名称： ），预计消费 XXX 元。"));var s=n.slice();return s[r]=h(h({},a),{},{notes:u}),s})},[]);return l.createElement("div",{className:"jihua-page"},l.createElement("header",{className:"jihua-header"},l.createElement("div",{className:"brand"},"旅行计划"),l.createElement("div",{className:"controls"},l.createElement("input",{disabled:!I,className:"search-input",placeholder:"搜索地点（输入≥2个字）回车或停顿触发","aria-label":"搜索地点",value:te,onChange:function(e){return t=e.target.value,ne(t),pt.current&&clearTimeout(pt.current),void(pt.current=setTimeout(function(){return ft(t)},250));var t},onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),ft(te))}}),l.createElement("button",{className:"icon-btn ".concat(ie?"active":""),title:"就近优先（按当前地图范围搜索）",onClick:function(){return oe(function(e){return!e})}},ie?"就近":"全局"),l.createElement("select",{className:"tile-select","aria-label":"瓦片源",value:fe,onChange:function(e){return pe(e.target.value)},disabled:!I},l.createElement("option",{value:"amap"},"高德(道路-深色)"),l.createElement("option",{value:"esriStreet"},"Esri街道"),l.createElement("option",{value:"esriImagery"},"Esri影像"),l.createElement("option",{value:"default"},"OSM"),N()?l.createElement("option",{value:"tdtVec"},"天地图-矢量"):null,N()?l.createElement("option",{value:"tdtImg"},"天地图-影像"):null,C().customTile.url?l.createElement("option",{value:"custom"},"自定义瓦片"):null),l.createElement("button",{className:"icon-btn",title:"定位到当前位置",onClick:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var n=e.coords,r=n.latitude,a=n.longitude;t.current&&t.current.setView([r,a],14)},function(){return X("定位失败，请检查权限")}):X("当前浏览器不支持定位")}},"定位"),l.createElement("div",{className:"view-toggle"},l.createElement("button",{className:"icon-btn ".concat("list"===he?"active":""),onClick:function(){return ye("list")}},"列表"),l.createElement("button",{className:"icon-btn ".concat("timeline"===he?"active":""),onClick:function(){return ye("timeline")}},"时间轴"),l.createElement("button",{className:"icon-btn ".concat("day"===he?"active":""),onClick:function(){return ye("day")}},"按天"),"timeline"===he?l.createElement("button",{className:"icon-btn",onClick:function(){B(function(e){return gt(e)}),Ne(!1)},title:"按时间排序"},"按时间排序"):null,l.createElement("button",{className:"icon-btn",onClick:Nt,title:"按日期时间排序并切换按天视图"},"按天排序"),l.createElement("button",{className:"icon-btn ".concat(Fe?"active":""),onClick:function(){return Le(function(e){return!e})},title:"路线型距离（OSRM）"},"路线距离")))),l.createElement("div",{className:"map-container",ref:e,"aria-label":"地图"}),(mt||ue.length>0)&&l.createElement("div",{className:"suggestions"},mt&&l.createElement("div",{className:"suggestion-item"},"搜索中…"),ue.map(function(e){return l.createElement("div",{key:e.place_id||e.osm_id,className:"suggestion-item",onClick:function(){var n=parseFloat(e.lat),r=parseFloat(e.lon),a=k(),o=V[V.length-1],c=o?T(o.lat,o.lng,n,r):0,l=o?x(c):"",u=o?"与上个地点直线距离约 ".concat(c.toFixed(1)," km · 交通：建议").concat(l):"",s={id:E(),placeId:String(e.place_id||e.osm_id||""),name:e.display_name||"未命名地点",lat:n,lng:r,date:a.date,time:a.time,notes:u};He(s),B(function(e){return[].concat((0,i.A)(e),[s])}),se([]),ne(""),t.current&&t.current.setView([n,r],14)}},l.createElement("div",{className:"sugg-title"},e.display_name),t.current?l.createElement("div",{className:"sugg-meta"},function(){try{var n=t.current.getCenter(),r=parseFloat(e.lat)-n.lat,a=parseFloat(e.lon)-n.lng,i=111*Math.sqrt(a*a+r*r);return"".concat(i.toFixed(1)," km")}catch(e){return""}}()):null)}),!mt&&0===ue.length&&l.createElement("div",{className:"suggestion-item"},"无搜索结果")),l.createElement("section",{className:"sheet"},l.createElement("div",{className:"sheet-header"},l.createElement("input",{className:"plan-name",value:G,onChange:function(e){return D(e.target.value)},placeholder:"计划名称"}),l.createElement("div",{className:"actions"},l.createElement("button",{className:"btn",onClick:it},"新建"),l.createElement("button",{className:"btn",onClick:at,disabled:Ke},Ke?"保存中…":"保存"),l.createElement("button",{className:"btn danger",onClick:ot,disabled:Ze},Ze?"删除中…":"删除"),l.createElement("button",{className:"btn",onClick:function(){return function(e,t,n){var r=[];r.push("计划名称: "+(e||"未命名")),r.push("");for(var a=0;a<t.length;a++){var i=t[a];if(r.push(a+1+". "+(i.name||"未命名地点")),r.push(("   时间: "+(i.date||"")+" "+(i.time||"")).trim()),r.push("   坐标: "+i.lat+", "+i.lng),a>=1){var o=n&&n[a];o&&r.push("   与上个地点距离: "+o.toFixed(1)+" km")}i.notes&&r.push("   备注: "+i.notes)}var c=new Blob([r.join("\n")],{type:"text/plain;charset=utf-8"}),l=URL.createObjectURL(c),u=document.createElement("a");u.href=l,u.download=(e||"旅行计划").replace(/[\\/:*?"<>|]/g,"_")+".txt",u.click(),URL.revokeObjectURL(l)}(G,V,bt)}},"导出TXT"),l.createElement("button",{className:"btn",onClick:function(){return function(e,t,n){var r=[];r.push("# ".concat(e||"旅行计划")),r.push(""),t.forEach(function(e){r.push("## ".concat(e.day||"未设日期","  · 当天总距离 ").concat(e.totalKm.toFixed(1)," km · 起止 ").concat(e.start||"").concat(e.end?" - "+e.end:"")),e.entries.forEach(function(e){var t=e.item,a=e.index,i=n&&n[a];r.push("- ".concat(a+1,". ").concat(t.date||""," ").concat(t.time||""," · ").concat(t.name||"").concat(i?" · 距上个 ".concat(i.toFixed(1)," km"):"")),r.push("  - 坐标: ".concat(t.lat,", ").concat(t.lng)),t.notes&&r.push("  - 备注: ".concat(t.notes))}),r.push("")});var a=new Blob([r.join("\n")],{type:"text/markdown;charset=utf-8"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=(e||"旅行计划").replace(/[\\/:*?"<>|]/g,"_")+".md",o.click(),URL.revokeObjectURL(i)}(G,wt,bt)}},"导出MD"),l.createElement("button",{className:"btn",onClick:function(){return function(e,t,n){for(var r=[["序号","日期","时间","名称","纬度","经度","距上个(km)","备注"]],a=0;a<t.length;a++){var i=t[a],o=n&&n[a];r.push([String(a+1),i.date||"",i.time||"",(i.name||"").replace(/\n/g," "),String(i.lat),String(i.lng),o?o.toFixed(1):"",(i.notes||"").replace(/\n/g," ")])}var c=r.map(function(e){return e.map(function(e){return'"'.concat(String(e).replace(/"/g,'""'),'"')}).join(",")}).join("\n"),l=new Blob([c],{type:"text/csv;charset=utf-8"}),u=URL.createObjectURL(l),s=document.createElement("a");s.href=u,s.download=(e||"旅行计划").replace(/[\\/:*?"<>|]/g,"_")+".csv",s.click(),URL.revokeObjectURL(u)}(G,V,bt)}},"导出CSV"))),l.createElement("div",{className:"plans-bar"},l.createElement("button",{className:"btn",onClick:nt,disabled:qe},qe?"加载中…":"刷新计划"),l.createElement("select",{className:"plan-select",onChange:function(e){return rt(e.target.value)},value:R||""},l.createElement("option",{value:"",disabled:!0},"选择已有计划"),(Ue||[]).map(function(e){return l.createElement("option",{key:e.id,value:e.id},e.name)}))),Z?l.createElement("div",{className:"error"},Z):null,Ve?l.createElement("div",{className:"error"},Ve):null,Qe?l.createElement("div",{className:"error"},Qe):null,We?l.createElement("div",{className:"error"},We):null,Xe?l.createElement("div",{className:"error"},Xe):null,"list"===he?l.createElement("ul",{className:"item-list"},V.map(function(e,t){return l.createElement("li",{className:"item",key:e.id,draggable:!0,onDragStart:function(){return $(t)},onDragOver:function(e){return e.preventDefault()},onDrop:function(){Je(Y,t),$(null)}},l.createElement("div",{className:"item-line"},l.createElement("div",{className:"index"},t+1),l.createElement("input",{className:"item-name",value:e.name,onChange:function(t){return et(e.id,"name",t.target.value)},placeholder:"地点名称/备注"}),l.createElement("select",{className:"icon-btn",onChange:function(t){return Tt(e.id,t.target.value)},defaultValue:""},l.createElement("option",{value:"",disabled:!0},"备注模板"),l.createElement("option",{value:"play"},"游玩"),l.createElement("option",{value:"move"},"移动"),l.createElement("option",{value:"stay"},"住宿")),l.createElement("select",{className:"icon-btn",onChange:function(t){var n=t.target.value;n&&(kt(e.id,n),t.target.value="")},defaultValue:""},l.createElement("option",{value:"",disabled:!0},"预计时长"),l.createElement("option",{value:"30分钟"},"30分钟"),l.createElement("option",{value:"1小时"},"1小时"),l.createElement("option",{value:"2小时"},"2小时"),l.createElement("option",{value:"半天"},"半天"),l.createElement("option",{value:"全天"},"全天")),l.createElement("div",{className:"move"},l.createElement("button",{className:"icon-btn",onClick:function(){return $e(t,-1)},disabled:0===t},"↑"),l.createElement("button",{className:"icon-btn",onClick:function(){return $e(t,1)},disabled:t===V.length-1},"↓")),l.createElement("button",{className:"icon-btn danger",onClick:function(){return Ye(e.id)}},"✕")),l.createElement("div",{className:"item-line"},l.createElement("input",{type:"date",className:"date-input",value:e.date||"",onChange:function(t){return et(e.id,"date",t.target.value)}}),l.createElement("input",{type:"time",className:"time-input",value:e.time||"",onChange:function(t){return et(e.id,"time",t.target.value)}}),l.createElement("div",{className:"coords"},e.lat.toFixed(5),", ",e.lng.toFixed(5),bt[t]?" · 距上个 ".concat(bt[t].toFixed(1)," km · 建议：").concat(x(bt[t])):"")),l.createElement("textarea",{className:"notes",rows:2,value:e.notes||"",onChange:function(t){return et(e.id,"notes",t.target.value)},placeholder:"备注"}))})):"timeline"===he?l.createElement("div",{className:"timeline"},ht.map(function(e,t){return l.createElement("div",{key:e.id,className:"timeline-item",draggable:!0,onDragStart:function(){return Te(t)},onDragOver:function(e){return e.preventDefault()},onDrop:function(){null!=Se&&(B(function(e){var n=gt(e).map(function(e){return e.id}),r=Se,a=t;if(r<0||r>=n.length||a<0||a>=n.length)return e;var i=n.splice(r,1),o=(0,c.A)(i,1)[0];n.splice(a,0,o);var l=new Map(e.map(function(e){return[e.id,e]}));return n.map(function(e){return l.get(e)}).filter(Boolean)}),Ne(!0),Te(null))}},l.createElement("div",{className:"timeline-left"},l.createElement("div",{className:"timeline-dot"}),l.createElement("div",{className:"timeline-line"})),l.createElement("div",{className:"timeline-content"},l.createElement("div",{className:"timeline-title"},l.createElement("span",{className:"index"},t+1),l.createElement("input",{className:"item-name",value:e.name,onChange:function(t){return et(e.id,"name",t.target.value)}}),l.createElement("div",{className:"move"},l.createElement("button",{className:"icon-btn",onClick:function(){B(function(e){var n=gt(e).map(function(e){return e.id}),r=t,a=t-1;if(r<=0)return e;var i=n.splice(r,1),o=(0,c.A)(i,1)[0];n.splice(a,0,o);var l=new Map(e.map(function(e){return[e.id,e]}));return n.map(function(e){return l.get(e)}).filter(Boolean)}),Ne(!0)},disabled:0===t},"↑"),l.createElement("button",{className:"icon-btn",onClick:function(){B(function(e){var n=gt(e).map(function(e){return e.id}),r=t,a=t+1;if(r>=n.length-1)return e;var i=n.splice(r,1),o=(0,c.A)(i,1)[0];n.splice(a,0,o);var l=new Map(e.map(function(e){return[e.id,e]}));return n.map(function(e){return l.get(e)}).filter(Boolean)}),Ne(!0)},disabled:t===ht.length-1},"↓")),l.createElement("button",{className:"icon-btn danger",onClick:function(){return Ye(e.id)}},"✕")),l.createElement("div",{className:"timeline-meta"},l.createElement("input",{type:"date",className:"date-input",value:e.date||"",onChange:function(t){return et(e.id,"date",t.target.value)}}),l.createElement("input",{type:"time",className:"time-input",value:e.time||"",onChange:function(t){return et(e.id,"time",t.target.value)}}),l.createElement("span",{className:"coords"},e.lat.toFixed(5),", ",e.lng.toFixed(5),bt[V.indexOf(e)]?" · 距上个 ".concat(bt[V.indexOf(e)].toFixed(1)," km · 建议：").concat(x(bt[V.indexOf(e)])):"")),l.createElement("textarea",{className:"notes",rows:2,value:e.notes||"",onChange:function(t){return et(e.id,"notes",t.target.value)},placeholder:"备注"})))})):l.createElement("div",{className:"day-groups"},wt.map(function(e){return l.createElement("div",{key:e.day,className:"day-section"},l.createElement("div",{className:"item-line",style:{fontWeight:600}},l.createElement("div",{className:"index"},e.day),l.createElement("div",{style:{marginLeft:8}},"当天总距离：",e.totalKm.toFixed(1)," km"),l.createElement("div",{style:{marginLeft:"auto"}},"起止：",e.start||"-",e.end?" - "+e.end:"")),l.createElement("ul",{className:"item-list"},e.entries.map(function(t){var n=t.item,r=t.index;return l.createElement("li",{className:"item",key:n.id,draggable:!0,onDragStart:function(){return $(r)},onDragOver:function(e){return e.preventDefault()},onDrop:function(){Je(Y,r),$(null)}},l.createElement("div",{className:"item-line"},l.createElement("div",{className:"index"},r+1,n.startOfDay?" · 起点":"",n.endOfDay?" · 终点":""),l.createElement("input",{className:"item-name",value:n.name,onChange:function(e){return et(n.id,"name",e.target.value)},placeholder:"地点名称/备注"}),l.createElement("button",{className:"icon-btn",onClick:function(){return Ct(e.day,n.id)}},"设为起点"),l.createElement("button",{className:"icon-btn",onClick:function(){return St(e.day,n.id)}},"设为终点"),l.createElement("select",{className:"icon-btn",onChange:function(e){return Tt(n.id,e.target.value)},defaultValue:""},l.createElement("option",{value:"",disabled:!0},"备注模板"),l.createElement("option",{value:"play"},"游玩"),l.createElement("option",{value:"move"},"移动"),l.createElement("option",{value:"stay"},"住宿")),l.createElement("select",{className:"icon-btn",onChange:function(e){var t=e.target.value;t&&(kt(n.id,t),e.target.value="")},defaultValue:""},l.createElement("option",{value:"",disabled:!0},"预计时长"),l.createElement("option",{value:"30分钟"},"30分钟"),l.createElement("option",{value:"1小时"},"1小时"),l.createElement("option",{value:"2小时"},"2小时"),l.createElement("option",{value:"半天"},"半天"),l.createElement("option",{value:"全天"},"全天")),l.createElement("button",{className:"icon-btn danger",onClick:function(){return Ye(n.id)}},"✕")),l.createElement("div",{className:"item-line"},l.createElement("input",{type:"date",className:"date-input",value:n.date||"",onChange:function(e){return et(n.id,"date",e.target.value)}}),l.createElement("input",{type:"time",className:"time-input",value:n.time||"",onChange:function(e){return et(n.id,"time",e.target.value)}}),l.createElement("div",{className:"coords"},n.lat.toFixed(5),", ",n.lng.toFixed(5),bt[r]?" · 距上个 ".concat(bt[r].toFixed(1)," km · 建议：").concat(x(bt[r])):"")),l.createElement("textarea",{className:"notes",rows:2,value:n.notes||"",onChange:function(e){return et(n.id,"notes",e.target.value)},placeholder:"备注"}))})))})),l.createElement("div",{className:"stats-bar"},l.createElement("div",null,"总距离：",Et.total.toFixed(1)," km"),Object.keys(Et.perDay).length>0&&l.createElement("div",{className:"stats-days"},Object.entries(Et.perDay).map(function(e){var t=(0,c.A)(e,2),n=t[0],r=t[1];return l.createElement("span",{key:n,className:"stats-day"},n||"未设日期","：",r.toFixed(1)," km")})))))}}}]);