(self.webpackChunkfzz_react_app=self.webpackChunkfzz_react_app||[]).push([[78],{5240:()=>{},9497:(e,s,o)=>{"use strict";o.r(s),o.d(s,{default:()=>h});var t=o(4467),r=o(3029),a=o(2901),i=o(6822),n=o(3954),l=o(5501),c=o(6540),g=(o(5240),o(4180)),m=o(1225);o(853);const u=o.p+"img/trpg-background.80ca3c59.jpg";function p(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(p=function(){return!!e})()}var d=function(e){function s(e){var o,a,l,c;return(0,r.A)(this,s),a=this,l=s,c=[e],l=(0,n.A)(l),(o=(0,i.A)(a,p()?Reflect.construct(l,c||[],(0,n.A)(a).constructor):l.apply(a,c))).toggleLoginForm=function(){o.setState({showLoginForm:!o.state.showLoginForm})},o.toggleCreateAccountModal=function(){o.setState({showCreateAccountModal:!o.state.showCreateAccountModal})},o.toggleForgotPasswordModal=function(){o.setState({showForgotPasswordModal:!o.state.showForgotPasswordModal})},o.handleSubmit=function(e){if(e.preventDefault(),!o.props.isLoginLoading){var s=o.state,t=s.username,r=s.password;t&&r?(o.setState({errorMessage:""}),o.props.dispatch({type:"LOGIN_REQUEST",payload:{userName:t,password:r}})):o.setState({errorMessage:"请输入账号和密码"})}},o.handleInputChange=function(e){o.setState((0,t.A)({},e.target.name,e.target.value))},o.handleRegister=function(e){if(e.preventDefault(),!o.props.isRegisterLoading){var s=o.state,t=s.username,r=s.email,a=s.mobile;t&&r&&a?(o.setState({errorMessage:"",successMessage:""}),o.props.dispatch({type:"REGISTER_REQUEST",payload:{username:t,email:r,mobile:a}})):o.setState({errorMessage:"请填写完整的注册信息"})}},o.handleForgotPassword=function(e){if(e.preventDefault(),!o.props.isForgotPasswordLoading){var s=o.state.resetEmail;s?(o.setState({errorMessage:"",successMessage:""}),o.props.dispatch({type:"FORGOT_PASSWORD_REQUEST",payload:{email:s}})):o.setState({errorMessage:"请输入邮箱地址"})}},o.clearMessages=function(){o.setState({successMessage:"",errorMessage:""})},o.state={showLoginForm:!1,showCreateAccountModal:!1,showForgotPasswordModal:!1,username:"",password:"",email:"",mobile:"",resetEmail:"",successMessage:"",errorMessage:""},o}return(0,l.A)(s,e),(0,a.A)(s,[{key:"componentDidUpdate",value:function(e){var s=this;this.props.user&&this.props.user!==e.user&&(console.log("Login successful, user:",this.props.user),this.setState({successMessage:"登录成功！正在跳转...",errorMessage:""}),setTimeout(function(){s.props.history.push("/home")},1e3)),this.props.error&&this.props.error!==e.error&&(console.log("Login error:",this.props.error),this.setState({errorMessage:this.props.error,successMessage:""})),this.props.registerSuccess&&this.props.registerSuccess!==e.registerSuccess&&this.setState({successMessage:"注册成功！",errorMessage:"",showCreateAccountModal:!1,username:"",email:"",mobile:""}),this.props.registerError&&this.props.registerError!==e.registerError&&this.setState({errorMessage:this.props.registerError,successMessage:""}),this.props.forgotPasswordSuccess&&this.props.forgotPasswordSuccess!==e.forgotPasswordSuccess&&this.setState({successMessage:"重置密码邮件已发送！",errorMessage:"",showForgotPasswordModal:!1,resetEmail:""}),this.props.forgotPasswordError&&this.props.forgotPasswordError!==e.forgotPasswordError&&this.setState({errorMessage:this.props.forgotPasswordError,successMessage:""}),this.props.registerSuccess&&this.props.registerSuccess!==e.registerSuccess&&this.setState({isRegisterLoading:!1,successMessage:"注册成功！",errorMessage:"",showCreateAccountModal:!1,username:"",email:"",mobile:""}),this.props.registerError&&this.props.registerError!==e.registerError&&this.setState({isRegisterLoading:!1,errorMessage:"注册失败，请重试",successMessage:""}),this.props.forgotPasswordSuccess&&this.props.forgotPasswordSuccess!==e.forgotPasswordSuccess&&this.setState({isForgotPasswordLoading:!1,successMessage:"重置密码邮件已发送！",errorMessage:"",showForgotPasswordModal:!1,resetEmail:""}),this.props.forgotPasswordError&&this.props.forgotPasswordError!==e.forgotPasswordError&&this.setState({isForgotPasswordLoading:!1,errorMessage:"发送失败，请重试",successMessage:""})}},{key:"render",value:function(){var e=this.state,s=e.showLoginForm,o=e.showCreateAccountModal,t=e.showForgotPasswordModal,r=e.username,a=e.password,i=e.email,n=e.mobile,l=e.resetEmail,g=e.successMessage,m=e.errorMessage,p=this.props,d=p.isLoginLoading,h=p.isRegisterLoading,b=p.isForgotPasswordLoading;return c.createElement("div",{className:"login-mobile-container",style:{backgroundImage:"url(".concat(u,")"),backgroundSize:"cover",minHeight:"100vh",padding:"12px 0",position:"relative",zIndex:1}},(g||m)&&c.createElement("div",{className:"login-message ".concat(g?"success":"error")},g||m,c.createElement("button",{className:"login-message-close",onClick:this.clearMessages},"×")),c.createElement("div",{className:"login-mobile-card"},!s&&c.createElement(c.Fragment,null,c.createElement("h1",{className:"login-mobile-title"},"迷雾巷跑团馆"),c.createElement("p",{className:"login-mobile-subtitle"},"Welcome to the Misty Alley Running Group Pavilion"),c.createElement("button",{className:"login-mobile-link",onClick:this.toggleLoginForm},s?"返回":"Enter the Abyss")),s&&c.createElement("div",{className:"login-mobile-form-box"},c.createElement("h2",{className:"login-mobile-form-title"},"登录"),c.createElement("form",{className:"login-mobile-form",onSubmit:this.handleSubmit},c.createElement("input",{type:"text",name:"username",placeholder:"账号",value:r,onChange:this.handleInputChange,className:"login-mobile-input",autoComplete:"username"}),c.createElement("input",{type:"password",name:"password",placeholder:"密码",value:a,onChange:this.handleInputChange,className:"login-mobile-input",autoComplete:"current-password"}),c.createElement("button",{type:"submit",className:"login-mobile-btn",disabled:d},d?"登录中...":"登录")),c.createElement("div",{className:"login-mobile-account-options"},c.createElement("button",{className:"login-mobile-account-btn",onClick:this.toggleCreateAccountModal},"创建新账户"),c.createElement("button",{className:"login-mobile-account-btn",onClick:this.toggleForgotPasswordModal},"忘记密码")))),o&&c.createElement("div",{className:"login-mobile-modal"},c.createElement("div",{className:"login-mobile-modal-content"},c.createElement("h2",{className:"login-mobile-modal-title"},"创建新账户"),c.createElement("form",{className:"login-mobile-modal-form",onSubmit:this.handleRegister},c.createElement("input",{type:"text",name:"username",placeholder:"用户名",value:r,onChange:this.handleInputChange,className:"login-mobile-input",autoComplete:"username"}),c.createElement("input",{type:"email",name:"email",placeholder:"邮箱",value:i,onChange:this.handleInputChange,className:"login-mobile-input",autoComplete:"email"}),c.createElement("input",{type:"text",name:"mobile",placeholder:"手机号",value:n,onChange:this.handleInputChange,className:"login-mobile-input",autoComplete:"tel"}),c.createElement("button",{type:"submit",className:"login-mobile-btn",disabled:h},h?"注册中...":"注册")),c.createElement("button",{className:"login-mobile-close-btn",onClick:this.toggleCreateAccountModal},"关闭"))),t&&c.createElement("div",{className:"login-mobile-modal"},c.createElement("div",{className:"login-mobile-modal-content"},c.createElement("h2",{className:"login-mobile-modal-title"},"忘记密码"),c.createElement("form",{className:"login-mobile-modal-form",onSubmit:this.handleForgotPassword},c.createElement("input",{type:"email",name:"resetEmail",placeholder:"注册邮箱",value:l,onChange:this.handleInputChange,className:"login-mobile-input",autoComplete:"email"}),c.createElement("button",{type:"submit",className:"login-mobile-btn",disabled:b},b?"提交中...":"提交")),c.createElement("button",{className:"login-mobile-close-btn",onClick:this.toggleForgotPasswordModal},"关闭"))))}}])}(c.Component);const h=(0,g.y)((0,m.Ng)(function(e){return{user:e.user,error:e.error,isLoginLoading:e.isLoginLoading,registerSuccess:e.registerSuccess,registerError:e.registerError,isRegisterLoading:e.isRegisterLoading,forgotPasswordSuccess:e.forgotPasswordSuccess,forgotPasswordError:e.forgotPasswordError,isForgotPasswordLoading:e.isForgotPasswordLoading}})(d))}}]);